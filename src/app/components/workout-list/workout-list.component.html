<div class="container">
  <div class="header">
    <h1 class="title">ワークアウトカレンダー</h1>
    <p class="subtitle">カレンダーでトレーニング記録を確認できます。</p>
  </div>

  <div class="layout">
    <div class="calendar-section">
      <div class="calendar-header">
        <button 
          (click)="changeMonth(-1)"
          class="month-button"
        >
          前月
        </button>
        <h2 class="month-title">
          {{ currentDate | date:'Y年M月' }}
        </h2>
        <button 
          (click)="changeMonth(1)"
          class="month-button"
        >
          次月
        </button>
      </div>

      <div class="calendar">
        <div class="calendar-grid">
          @for (day of ['日', '月', '火', '水', '木', '金', '土']; track day) {
            <div class="calendar-weekday">
              {{ day }}
            </div>
          }
        </div>

        <div class="calendar-grid">
          @for (date of calendarDays; track date) {
            <div 
              class="calendar-day"
              [class.inactive]="!isCurrentMonth(date)"
              [class.active]="isCurrentMonth(date)"
              [class.selected]="workoutService.getDateString(date) === selectedDate"
              (click)="selectDate(date)"
            >
              <div class="day-header">
                <div class="day-number">
                  @if (isToday(date)) {
                    <div class="day-number-today">
                      {{ date | date:'d' }}
                    </div>
                  } @else {
                    <div>
                      {{ date | date:'d' }}
                    </div>
                  }
                </div>

                @if (isCurrentMonth(date) && hasWorkout(date)) {
                  <div class="day-badge">
                    {{ getWorkoutCount(date) }}種目
                  </div>
                }
              </div>
            </div>
          }
        </div>
      </div>
    </div>

    <div class="details-section">
      @if (selectedDate && getSelectedWorkouts()) {
        <div class="details-card">
          <div class="details-header">
            <h3 class="details-title">
              {{ selectedDate | date:'Y年M月d日' }}のワークアウト
            </h3>
            <button
              (click)="deleteWorkouts(selectedDate, $event)"
              class="delete-button"
            >
              削除
            </button>
          </div>

          <div class="details-content">
            @for (workout of getSelectedWorkouts()!; track workout.id) {
              @for (exercise of workout.exercises; track exercise.name) {
                <div class="exercise-card">
                  <button
                    (click)="toggleExercise(workout.id, exercise.name)"
                    class="exercise-header"
                  >
                    <div class="exercise-title">
                      <h4 class="exercise-name">{{ exercise.name }}</h4>
                      <span class="exercise-sets-badge">
                        {{ exercise.sets.length }}セット
                      </span>
                    </div>
                    <div class="exercise-info">
                      <svg
                        [class.rotate-180]="isExerciseExpanded(workout.id, exercise.name)"
                        class="h-4 w-4 transition-transform"
                        xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        strokeWidth="2"
                        strokeLinecap="round"
                        strokeLinejoin="round"
                      >
                        <polyline points="6 9 12 15 18 9"></polyline>
                      </svg>
                    </div>
                  </button>

                  @if (isExerciseExpanded(workout.id, exercise.name)) {
                    <div class="exercise-details">
                      @for (set of exercise.sets; track $index) {
                        <div class="set-row">
                          <div class="set-info">
                            <span class="set-number">セット{{ $index + 1 }}</span>
                            <div class="set-weight">
                              <span class="set-value">{{ set.weight }}</span>
                              <span class="set-unit">kg</span>
                            </div>
                            <div class="set-reps">
                              <span class="set-value">{{ set.reps }}</span>
                              <span class="set-unit">回</span>
                            </div>
                          </div>
                          <div class="set-total">
                            {{ set.weight * set.reps }}kg
                          </div>
                        </div>
                      }
                    </div>
                  }
                </div>
              }
            }
          </div>
        </div>
      } @else {
        <div class="empty-state">
          日付を選択してください
        </div>
      }
    </div>
  </div>
</div>